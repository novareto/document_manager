name: UVCREHA testing

components:

  storage:
    factory: ${class:roughrider.storage.meta.StorageCenter}

  auth_bypass:
    factory: ${class:uvcreha.auth.filters.security_bypass}
    config:
       urls:
         - /login

  auth_urls:
    factory: ${class:uvcreha.auth.filters.secured}
    config:
       path: /login

  auth_user_states:
    factory: ${class:uvcreha.auth.filters.filter_user_state}
    config:
       states:
         - ${class:uvcreha.workflow.user_workflow.states.inactive}
         - ${class:uvcreha.workflow.user_workflow.states.closed}

  auth_twoFA:
    factory: ${class:uvcreha.auth.filters.TwoFA}
    config:
       path: /2FA

  session:
    factory: ${class:uvcreha.plugins.session_middleware}
    config:
      cache: ???
      cookie_name: uvcreha.cookie
      cookie_secret: secret
      environ_key: uvcreha.test.session

  arango:
    factory: ${class:reiter.arango.connector.Connector.from_config}
    config: ???

  authentication:
    factory: ${class:uvcreha.auth.Auth}
    config:
      user_key: test.principal
      session_key: ${components.session.config.environ_key}
      connector: ${component:arango}
      filters:
        - ${component:auth_bypass}
        - ${component:auth_urls}
        - ${component:auth_user_states}
        - ${component:auth_twoFA}

  flash:
    factory: ${class:uvcreha.plugins.flash_messages}
    config:
      session_key: ${components.session.config.environ_key}

  webpush:
    factory: ${class:uvcreha.plugins.webpush_plugin}
    config:
      public_key: ${path:identities/public_key.txt}
      private_key: ${path:identities/private_key.txt}
      vapid_claims:
        sub: mailto:cklinger@novareto.de
        aud: https://updates.push.services.mozilla.com

  emailer:
    factory: ${class:uvcreha.emailer.SecureMailer}
    config:
      user:
      password:
      emitter: uvcreha@novareto.de

  twoFA:
    factory: ${class:uvcreha.auth.utilities.TwoFA}
    config:
      session_key: ${components.session.config.environ_key}


apps:

  browser:

    factory: ${class:reiter.application.app.BrowserApplication}

    config:
      name: Browser
      request_factory: ${class:uvcreha.request.Request}
      routes: ${class:uvcreha.app.browser}
      subscribers: ${class:uvcreha.app.events}
      ui: ${class:uvcreha.app.ui}
      utilities:
        arango: ${component:arango}
        authentication: ${component:authentication}
        emailer: ${component:emailer}
        flash: ${component:flash}
        twoFA: ${component:twoFA}
        webpush: ${component:webpush}

    middlewares:
      - ${component:session}
      - ${component:authentication}

    modules:
      - ${class:uvcreha}
